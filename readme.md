# Hybrid System Leaning

- Python 3.9
```
python CreatData.py
python main.py
```

- data 文件夹存放 CreatData 文件生成的轨迹
- automata 文件夹存放自动机数据
- 自动机数据的json格式如下
```json5
{
  "automation": { // 自动机
    "var": "x1, x2", // 变量列表，用','隔开
    "mode": [ // 自动机的模式列表
      {
        "id": 1, // 模式的id
        "eq": "x1[1] = 1, x2[2] = -3 * x2[1] - 25 * x2[0] + 25"
        // 该模式下各变量的ode，以','隔开
        // 不能出现没有在var中定义的变量，x[k]表示x的k阶微分
        // 等号左侧为最高阶微分，等号右侧是表达式，不支持隐函数
        // 必须为每个变量都提供ode
      },
      {
        "id": 2,
        "eq": "x1[1] = -1, x2[2] = -3 * x2[1] - 25 * x2[0]"
      }
    ],
    "edge": [
      {
        "direction": "1 -> 2", // 从 mode u 到 mode v 的边表示为 ”u -> v“
        "condition": "x1 >= 5" // 转移条件，不能出现var中未定义的变量
      },
      {
        "direction": "2 -> 1",
        "condition": "x1 <= 0"
      }
    ]
  },
  "init_state": [ // 初始状态列表，有几种初始状态生成几个轨迹数据
    {
      "mode": 1, // 初始模式
      "x1": [0], // x1的初始状态，[a, b, c, ...] 分别是x1[0], x1[1], x1[2], ...的初始状态
      "x2": [0]  // 如果未提供初始状态，或提供的初始状态个数不足方程阶数+1，会自动向后补0
    },
    {
      "mode": 1,
      "x1": [2],
      "x2": [3]
    }
  ],
  "config": {                   // 拟合差分方程的参数
    "dt": 0.01,                 // 离散时间，默认0.01
    "total_time": 10.0,         // 采样总时间，默认10
    "dim": 3,                   // 差分方程的维度，默认3
    "window_size": 10,          // 滑动窗口大小，默认10
    "clustering_method": "fit", // 聚类方法，默认fit，有fit和dis两种选项
    "minus": false,             // 是否最小化阶数，默认为false
    "need_bias": false,         // 是否需要常数项，默认为false
    "kernel": "linear",         // SVM核函数，默认为linear
    "other_items": ""           // 差分方程的其他非线性项或交叉项，默认为空
    // other_item: 说明
    // 例如 "x0, x2, x3: x[1] * x_[?]; x[?] * x1[2]"
    // 表达式使用分号(;)隔开
    // 冒号(:)前为该表达式的作用域，xi表示对第i个变量(从0开始)生效，如果不写作用域默认对所有变量生效
    // x代表变量自身，x_代表除自己以外的其他任意变量，xi代表第i个变量
    // x[1]代表x[t - 1]，x[a]代表x[t - a]，为差分的前a项，不允许出现大于dim的项，不允许出现0项
    // x[?]代表属于[1, dim]中的任意项
    
    // 例子
    // dim = 2, other_items = "x0, x2: x[1] * x_[?]"
    // 对于x0，会额外拟合x0[1] * x1[1], x0[1] * x1[2], x0[1] * x2[1], x0[1] * x2[2]
    // 对于x1，不会额外拟合任何项
    // 对于x2，会额外拟合x2[1] * x0[1], x2[1] * x0[2], x2[1] * x1[1], x2[1] * x1[2]
  }
}
```